#!/bin/bash

# PayBack Pre-Commit Hook
# Runs unit tests before allowing commit
# To install: git config core.hooksPath .githooks

set -e

echo "üß™ Running unit tests before commit..."
echo ""

# Check if xcodebuild is available
if ! command -v xcodebuild &> /dev/null; then
    echo "‚ùå xcodebuild not found. Skipping tests."
    exit 0
fi

# Run unit tests
if xcodebuild test \
    -project PayBack.xcodeproj \
    -scheme PayBackTests \
    -configuration Debug \
    -destination 'platform=iOS Simulator,OS=latest,name=iPhone 15 Pro' \
    -quiet \
    2>&1 | grep -E "(Test Suite|FAILED|PASSED)"; then
    
    echo ""
    echo "‚úÖ All tests passed! Proceeding with commit."
    exit 0
else
    echo ""
    echo "‚ùå Tests failed! Commit aborted."
    echo ""
    echo "To skip this check (not recommended), use:"
    echo "  git commit --no-verify"
    exit 1
fi
